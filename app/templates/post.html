{% extends 'layout.html' %}
{% block content %}
<div class="post-container">
  <div class="header">
   <div>
    <div class="title">{{post.title}}</div>
    <div class="info">{{post.created_at|date:"d-m-Y"}}</div>
   </div>
   {% if post.author == user %}
   <div class="buttons">
    <a class = 'button primary'href="{% url 'app:edit_post' post.pk %}">
      <ion-icon name="create-outline"></ion-icon>
    </a>
    <a class='button danger'href="{% url 'app:post_delete' post.pk %}">
      <ion-icon name="trash-outline"></ion-icon>
    </a>
   </div>
   {% endif %}
  </div>
  <div>
    <div class="image">
      <img src="{{post.image.url}}" alt="" />
    </div>
    <div class="post-body">{{post.body}}</div>
    <hr />
    <div class="post-buttons">
      <a href="{% url 'app:post_like' post.pk %}" class="post-button {% if user in post.likes.all %} primary {% endif %}">
        <ion-icon name="thumbs-up-outline"></ion-icon>
        <i>
         {{post.likes.count}}
        </i>
      </a>
      <a href="{% url 'app:post_dislike' post.pk %}" class="post-button {% if user in post.dislikes.all %} danger {% endif %}">
        <ion-icon name="thumbs-down-outline"></ion-icon>
        <i>{{post.dislikes.count}}</i>
      </a>
    </div>
    <form class="comments" method="post" action="{% url 'app:comment_create' %}">
      {% csrf_token %}
      {% for field in form %}
      {{field}}
      {% endfor %}
      <input type="hidden" name="post" value="{{post.pk}}">
      <div class="title">Пока нет комментариев</div>
      <div class="comments-list">
        
        {% for comment in post.comment_set.all %}

        <div class="comment">
          {% if user == comment.author %}
          <div class="comment-buttons">
            <a href="{% url 'app:comment_edit' comment.pk %}" class="comment-button primary" >
              <ion-icon name="create-outline"></ion-icon>
            </a>
            <a href="{% url 'app:comment_delete' comment.pk %}" class="comment-button danger">
              <ion-icon name="trash-outline"></ion-icon>
            </a>
          </div>
          {% endif %}
          <div class="comment-head">
            <div class="avatar">
              <img src="https://cdn-icons-png.flaticon.com/512/6596/6596121.png" alt="">
            </div>
            <div class="user-data">
              <div class="username">
                {{comment.author.username}}
              </div>
              <div class="date">
                {{comment.created_at|date:"d.m.Y h:i"}}  
              </div>
            </div>
          </div>
          <div class="comment-body">
            {{comment.body}}
          </div>
          <div class="comment-footer">
            <div class="buttons">
               <a href="{% url 'app:comment_like' comment.pk %}" class="btn {% if user in comment.likes.all %} primary {% endif %}">
                <ion-icon name="thumbs-up-outline"></ion-icon>
                <i>{{comment.likes.count}}</i>
               </a>
               <a href="{% url 'app:comment_dislike' comment.pk %}" class="btn {% if user in comment.dislikes.all %} danger {% endif %}">
                <ion-icon name="thumbs-down-outline"></ion-icon>
                <i>{{comment.dislikes.count}}</i>
               </a>
            </div>
            <a href="{% url 'app:reply' comment.pk %}" class="reply">
              Ответить 
            </a>
          </div>
          <div class="updated" style="color: lightgray; text-align: right;">
            {% if comment.is_updated %}
            Изменено
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </form>
   
  </div>
  {% endblock %}





  <!-- {% if post.author == user %}
  <div class="buttons">
   <a class = 'button primary'href="{% url 'app:edit_post' post.pk %}">
     <ion-icon name="create-outline"></ion-icon>
   </a>
   <a class='button danger'href="{% url 'app:post_delete' post.pk %}">
     <ion-icon name="trash-outline"></ion-icon>
   </a>
  </div>
  {% endif %} -->

  <!-- Поставиили условие проверки совпадение автора и пользователя. Пользователь должен 
  редактировать только свой пост -->

  <!-- {{comment.created_at|date:"d.m.Y h:i"}} - Форматирование даты и добавление времени -->

  <!--  <input type="hidden" name="post" value="{{post.pk}}"> - Это скрытый input который сохраняет  
    id поста под которым пишется комментарий  -->



  <!--  <div class="post-buttons">
      <a href="{% url 'app:post_like' post.pk %}" class="post-button {% if user in post.likes.all %} primary {% endif %}">
        <ion-icon name="thumbs-up-outline"></ion-icon>  ------  кнопка лайка и функция для того что бы лайк отмечался -->
  <!-- {{post.likes.count}} Выводит кол-во лайкнувших людей -->