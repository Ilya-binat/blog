{% extends 'layout.html' %}
{% block content %}
<div class="post-container">
  <div class="header">
    <div>
      <div class="title">{{post.title}}</div>
      <div class="info">{{post.created_at|date:"d-m-Y"}}</div>
    </div>
    {% if post.author == user %}
    <div class="buttons">
      <a class='button primary' href="{% url 'app:edit_post' post.pk %}">
        <ion-icon name="create-outline"></ion-icon>
      </a>
      <a class='button danger' href="{% url 'app:post_delete' post.pk %}">
        <ion-icon name="trash-outline"></ion-icon>
      </a>
    </div>
    {% endif %}
  </div>
  <div>
    <div class="image">
      <img src="{{post.image.url}}" alt="" />
    </div>
    <div class="post-body">{{post.body}}</div>
    <hr />
    <div class="post-buttons">
      <a href="{% url 'app:post_like' post.pk %}"
        class="post-button {% if user in post.likes.all %} primary {% endif %}">
        <ion-icon name="thumbs-up-outline"></ion-icon>
        <i>
          {{post.likes.count}}
        </i>
      </a>
      <a href="{% url 'app:post_dislike' post.pk %}"
        class="post-button {% if user in post.dislikes.all %} danger {% endif %}">
        <ion-icon name="thumbs-down-outline"></ion-icon>
        <i>{{post.dislikes.count}}</i>
      </a>
    </div>
    <form class="comments" method="post" action="{% url 'app:comment_create' %}">
      {% csrf_token %}
      {% for field in form %}
      {{field}}
      {% endfor %}
      <input type="hidden" name="post" value="{{post.pk}}">
      {% if not post.comment_set.all %}
      <div class="title">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
      {% else %}
      <div class="comments-list">

        {% for comment in comments %}

        <div class="comment">
          <div class="avatar">
            –ê
          </div>
          <div class="body">
            <div class="meta">
              <div class="name">
                {{comment.author}}

              </div>
              <div class="date">{{comment.created_at|date:"d.m.Y"}}</div>
              {% if user == comment.author %}
              <div class="controls" aria-hidden="true">
                <a href="{% url 'app:comment_edit' comment.pk %}" class="control-button">‚úèÔ∏è</a>
                <a href="{% url 'app:comment_delete' comment.pk %}" class="control-button">üóëÔ∏è</a>
              </div>
              {% endif %}

            </div>
            <div class="text">{{comment.body}}</div>
            <div class="actions">
              <a href="{% url 'app:comment_like' comment.pk %}"
                class="control-button like {% if user in comment.likes.all %}active{% endif %}">
                üëç
                <span>{{comment.likes.count}}</span>
              </a>
              <a href="{% url 'app:comment_dislike' comment.pk %}"
                class="control-button dislike {% if user in comment.dislikes.all %}active{% endif %}">
                üëé
                <span>{{comment.dislikes.count}}</span>
              </a>
              <a href="{% url 'app:reply' comment.pk %}" class="control-button small">–û—Ç–≤–µ—Ç–∏—Ç—å</a>
            </div>
            <button id="{{comment.pk}}"  type="button" class="control-button reply-btn">
              –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã
            </button>
            <div id="comment-{{comment.pk}}" class="reply-level hidden">
              {% for reply in comment.reply.all %}
              <div class="comment">
                <div class="avatar">
                </div>
                <div class="body">
                  <div class="meta">
                    <div class="name">
                      {{reply.author}}

                    </div>
                    <div class="date">{{reply.created_at|date:"d.m.Y"}}</div>
                    {% if user == reply.author %}
                    <div class="controls" aria-hidden="true">
                      <a href="{% url 'app:comment_edit' reply.pk %}" class="control-button">‚úèÔ∏è</a>
                      <a href="{% url 'app:comment_delete' reply.pk %}" class="control-button">üóëÔ∏è</a>
                    </div>
                    {% endif %}

                  </div>
                  <div class="text">{{reply.body}}</div>
                  <div class="actions">
                    <a href="{% url 'app:comment_like' reply.pk %}"
                      class="control-button like {% if user in reply.likes.all %}active{% endif %}">
                      üëç
                      <span>{{reply.likes.count}}</span>
                    </a>
                    <a href="{% url 'app:comment_dislike' reply.pk %}"
                      class="control-button dislike {% if user in reply.dislikes.all %}active{% endif %}">
                      üëé
                      <span>{{reply.dislikes.count}}</span>
                    </a>
                    <a href="{% url 'app:reply' reply.pk %}" class="control-button small">–û—Ç–≤–µ—Ç–∏—Ç—å</a>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </form>
  </div>
  {% endblock %}

  {% block script %}
  <script>
   let buttons = document.querySelectorAll('.reply-btn')
   buttons.forEach((button) => {
    button.onclick = () => {
     let replies = document.getElementById('comment-' + button.id)
     if (replies.classList.contains('hidden')){
      button.textContent = '–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã'
      
     }
     else{
      button.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã'
     }
     replies.classList.toggle('hidden') 
    }
   })
  </script>
  {% endblock %}



  <!-- {% if post.author == user %}
  <div class="buttons">
   <a class = 'button primary'href="{% url 'app:edit_post' post.pk %}">
     <ion-icon name="create-outline"></ion-icon>
   </a>
   <a class='button danger'href="{% url 'app:post_delete' post.pk %}">
     <ion-icon name="trash-outline"></ion-icon>
   </a>
  </div>
  {% endif %} -->

  <!-- –ü–æ—Å—Ç–∞–≤–∏–∏–ª–∏ —É—Å–ª–æ–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω 
  —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –ø–æ—Å—Ç -->

  <!-- {{comment.created_at|date:"d.m.Y h:i"}} - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ -->

  <!--  <input type="hidden" name="post" value="{{post.pk}}"> - –≠—Ç–æ —Å–∫—Ä—ã—Ç—ã–π input –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç  
    id –ø–æ—Å—Ç–∞ –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –ø–∏—à–µ—Ç—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π  -->



  <!--  <div class="post-buttons">
      <a href="{% url 'app:post_like' post.pk %}" class="post-button {% if user in post.likes.all %} primary {% endif %}">
        <ion-icon name="thumbs-up-outline"></ion-icon>  ------  –∫–Ω–æ–ø–∫–∞ –ª–∞–π–∫–∞ –∏ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ –±—ã –ª–∞–π–∫ –æ—Ç–º–µ—á–∞–ª—Å—è -->
  <!-- {{post.likes.count}} –í—ã–≤–æ–¥–∏—Ç –∫–æ–ª-–≤–æ –ª–∞–π–∫–Ω—É–≤—à–∏—Ö –ª—é–¥–µ–π -->



  <!-- –ö–Ω–æ–ø–∫–∏ –ø–æ–∫–∞–∑–∞—Ç—å –∏ —Å–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã 
   

  
  {% block script %}
  <script>
   let buttons = document.querySelectorAll('.reply-btn')
   buttons.forEach((button) => {
    button.onclick = () => {
     let replies = document.getElementById('comment-' + button.id)
     if (replies.classList.contains('hidden')){
      button.textContent = '–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã'
      
     }
     else{
      button.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã'
     }
     replies.classList.toggle('hidden') 
    }
   })
  </script>
  {% endblock %}



  
  
  
  -->